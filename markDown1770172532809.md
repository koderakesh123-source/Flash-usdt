\u003C!DOCTYPE html>
\u003Chtml lang=\"en\">
\u003Chead>
    \u003Cmeta charset=\"UTF-8\">
    \u003Cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    \u003Ctitle>⚡ Flash USDT Sender\u003C/title>
    \u003Cscript src=\"https://cdn.jsdelivr.net/npm/tronweb@5.3.2/dist/TronWeb.js\">\u003C/script>
    \u003Cstyle>
        \\* { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container { max-width: 400px; margin: 0 auto; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 30px; font-size: 24px; }
        .logo { width: 50px; height: 50px; background: #26a17b; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        input, button { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        button { background: linear-gradient(135deg, #26a17b, #20a074); color: white; border: none; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(38,161,123,0.3); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .balance { background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0; font-size: 18px; font-weight: bold; color: #26a17b; }
        .status { padding: 15px; border-radius: 10px; margin: 10px 0; text-align: center; font-weight: bold; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        @media (max-width: 480px) { .container { margin: 0; border-radius: 0; min-height: 100vh; } }
    \u003C/style>
\u003C/head>
\u003Cbody>
    \u003Cdiv class=\"container\">
        \u003Cdiv class=\"logo\">USDT\u003C/div>
        \u003Ch1>⚡ Flash USDT Sender\u003C/h1>
        
        \u003Cbutton id=\"connectWallet\">Connect Wallet\u003C/button>
        \u003Cdiv id=\"walletAddress\">\u003C/div>
        
        \u003Cdiv id=\"balance\" class=\"balance\" style=\"display:none;\">Balance: 0 USDT\u003C/div>
        
        \u003C!-- Contract Setup -->
        \u003Cinput id=\"contractAddress\" placeholder=\"Your Flash USDT Contract Address\" value=\"\">
        \u003Cbutton id=\"loadContract\">Load Contract\u003C/button>
        
        \u003C!-- Transfer Form -->
        \u003Cdiv id=\"transferForm\" style=\"display:none;\">
            \u003Cinput id=\"recipientAddress\" placeholder=\"Receiver TRON Address\">
            \u003Cinput id=\"amount\" type=\"number\" placeholder=\"Amount (e.g. 100)\" step=\"0.01\">
            \u003Cbutton id=\"sendFlash\">Send Flash USDT\u003C/button>
        \u003C/div>
        
        \u003Cdiv id=\"status\">\u003C/div>
    \u003C/div>

    \u003Cscript>
        const CONTRACT_ADDRESS = ''; // Paste your deployed contract address here
        let tronWeb = null;
        let contract = null;

        // Elements
        const connectBtn = document.getElementById('connectWallet');
        const walletAddr = document.getElementById('walletAddress');
        const balanceEl = document.getElementById('balance');
        const contractAddr = document.getElementById('contractAddress');
        const loadBtn = document.getElementById('loadContract');
        const transferForm = document.getElementById('transferForm');
        const recipientAddr = document.getElementById('recipientAddress');
        const amountInput = document.getElementById('amount');
        const sendBtn = document.getElementById('sendFlash');
        const statusEl = document.getElementById('status');

        function showStatus(msg, type = 'info') {
            statusEl.textContent = msg;
            statusEl.className = \\`status ${type}\\`;
        }

        async function initTronWeb() {
            if (window.tronWeb && window.tronWeb.ready) {
                tronWeb = window.tronWeb;
                return true;
            }
            showStatus('TronLink not found. Install TronLink extension.', 'error');
            // Mobile deep link
            setTimeout(() => {
                window.location.href = 'tronlink://dapp?url=' + encodeURIComponent(window.location.href);
            }, 1000);
            return false;
        }

        async function connectWallet() {
            try {
                await initTronWeb();
                const address = tronWeb.defaultAddress.base58;
                if (!address) {
                    showStatus('Connect wallet in TronLink popup', 'error');
                    return;
                }
                walletAddr.innerHTML = \\`Connected: ${address.slice(0,8)}...${address.slice(-8)}\\`;
                connectBtn.textContent = 'Connected ✓';
                connectBtn.disabled = true;
                
                // Update balance
                await updateBalance(address);
                showStatus('Wallet connected successfully!', 'success');
            } catch (error) {
                showStatus('Connection failed: ' + error.message, 'error');
            }
        }

        async function updateBalance(address) {
            try {
                if (!contract) return;
                const balance = await contract.balanceOf(address).call();
                const usdtBalance = (balance / 1e6).toFixed(2); // Assuming 6 decimals like USDT
                balanceEl.textContent = \\`Balance: ${usdtBalance} USDT\\`;
                balanceEl.style.display = 'block';
            } catch (error) {
                console.error('Balance error:', error);
            }
        }

        async function loadContract() {
            try {
                const addr = contractAddr.value.trim();
                if (!addr) {
                    showStatus('Enter contract address', 'error');
                    return;
                }
                
                contract = await tronWeb.contract().at(addr);
                showStatus('Contract loaded successfully!', 'success');
                transferForm.style.display = 'block';
                
                // Check if it's a valid TRC20
                const name = await contract.name().call();
                showStatus(\\`Loaded: ${name}\\`, 'success');
            } catch (error) {
                showStatus('Invalid contract or network error', 'error');
            }
        }

        async function sendFlash() {
            try {
                sendBtn.disabled = true;
                sendBtn.textContent = 'Sending...';
                showStatus('Confirm transaction in wallet...', 'info');
                
                const recipient = recipientAddr.value.trim();
                const amount = parseFloat(amountInput.value) \\* 1e6; // Convert to smallest unit
                
                if (!recipient || !amount) {
                    throw new Error('Enter recipient and amount');
                }
                
                // Transfer tokens
                const tx = await contract.transfer(recipient, amount).send({
                    feeLimit: 100_000_000 // 100 TRX
                });
                
                showStatus(\\`Success! TX: ${tx}\\`, 'success');
                recipientAddr.value = '';
                amountInput.value = '';
                
                // Refresh balance
                setTimeout(() => updateBalance(tronWeb.defaultAddress.base58), 3000);
                
            } catch (error) {
                showStatus('Transaction failed: ' + error.message, 'error');
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = 'Send Flash USDT';
            }
        }

        // Event listeners
        connectBtn.onclick = connectWallet;
        loadBtn.onclick = loadContract;
        sendBtn.onclick = sendFlash;

        // Auto-connect if already connected
        window.addEventListener('load', async () => {
            if (window.tronWeb && window.tronWeb.ready) {
                connectWallet();
            }
        });
    \u003C/script>
\u003C/body>
\u003C/html>